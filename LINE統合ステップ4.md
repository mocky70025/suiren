# LINE統合 ステップ4: Webhook URLの設定

## 🎯 このステップの目標

LINE DevelopersでWebhook URLを設定し、LINEからのメッセージを受信できるようにします。

## 📋 前提条件

- ステップ2で環境変数を設定済み
- ステップ3でパッケージをインストール済み
- サーバーがデプロイ済み（Renderなど）

## 📋 手順

### 1. サーバーのURLを確認

あなたのサーバーのURLを確認：
- Renderの場合：`https://あなたのサービス名.onrender.com`
- 例：`https://suiren.onrender.com`

### 2. LINE DevelopersでWebhook URLを設定

1. [LINE Developers](https://developers.line.biz/) にログイン
2. 作成したプロバイダーを選択
3. Messaging APIチャネルを選択
4. 左メニューから「Messaging API」をクリック
5. 「Webhook URL」セクションで以下を入力：

```
https://あなたのサーバーURL/api/line/webhook
```

例：
```
https://suiren.onrender.com/api/line/webhook
```

6. 「検証」をクリック
   - 成功すると「Webhookイベントの受信」が「利用する」になります
   - 失敗する場合は、サーバーが起動しているか確認してください

### 3. Webhookの利用を有効化

1. 「Webhookの利用」を「利用する」に設定
2. 「応答メッセージ」を「利用しない」に設定
   - ⚠️ 重要：Webhookで処理するため、「利用しない」にします

### 4. 動作確認

1. LINE公式アカウントを友だち追加（ステップ1で取得したQRコードを使用）
2. 何かメッセージを送信（例：「テスト」）
3. サーバーのログを確認（Render Dashboardの「Logs」タブ）
   - Webhookイベントが受信されていれば成功

## ✅ 完了チェックリスト

- [ ] Webhook URLを設定した
- [ ] 「検証」で成功した
- [ ] 「Webhookの利用」を「利用する」に設定した
- [ ] 「応答メッセージ」を「利用しない」に設定した
- [ ] LINE公式アカウントを友だち追加した
- [ ] メッセージを送信して動作確認した

## ⚠️ トラブルシューティング

### Webhook検証が失敗する場合

1. サーバーが起動しているか確認
2. URLが正しいか確認（`/api/line/webhook`で終わっているか）
3. HTTPSを使用しているか確認（HTTPは不可）
4. サーバーのログを確認してエラーがないか確認

### メッセージが返ってこない場合

1. 「応答メッセージ」が「利用しない」になっているか確認
2. サーバーのログを確認
3. 環境変数が正しく設定されているか確認

## ➡️ 次のステップ

ステップ4が完了したら、**ステップ5: 動作確認とテスト**に進みます。

