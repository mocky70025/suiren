# すいれん システム機能説明書（猿でもわかる版）

## 📋 システムの全体像

このシステムは、**学校内での転売のための支払い管理システム**です。
- **買い手**：商品を買う人（支払う人）
- **売り手**：商品を売る人（お金を受け取る人）
- **運営**：全体を管理する人

---

## 🎯 ページの種類

### 1. **一般ユーザー用ページ** (`index.html`)
買い手と売り手が使うページ

### 2. **運営用ページ** (`admin.html`)
運営だけが使う管理ページ

---

## 👤 一般ユーザー用ページの機能

### 🔐 ログイン・新規登録
- **新規登録**：初めて使う人は、ユーザー名とパスワードを設定して登録
- **ログイン**：登録済みの人は、ユーザー名とパスワードでログイン

### 💳 ポイントカード機能（買い手・売り手共通）
- **累計支払い金額**：今までに支払った合計金額が表示される
- **支払い履歴**：過去の支払い記録が一覧で見られる
  - いつ、いくら、誰に支払ったかが記録される

### 💰 支払い機能（買い手用）
1. **支払い金額を入力**
   - 例：1000円
2. **「PayPayで支払う」ボタンをクリック**
   - PayPayのQRコードが表示される
   - またはPayPayアプリを開くリンクが表示される
3. **PayPayアプリで送金を完了**
   - 実際にPayPayアプリで送金する
4. **「支払い完了」ボタンをクリック**
   - ポイントカードに金額が追加される
   - 支払い履歴に記録される

### 📱 QRコードスキャンで支払う（買い手用）
1. **売り手のQRコードをスキャン**
   - 売り手が印刷したQRコードをPayPayアプリでスキャン
2. **自動的に支払いページが開く**
   - 売り手の名前が表示される
3. **金額を入力して支払う**
   - 上記の「支払い機能」と同じ流れ

### 📝 受け取り記録（売り手用）
売り手が「お金を受け取った」ことを記録する機能

1. **受け取った金額を入力**
   - 例：1000円
2. **買い手のユーザー名を入力**
   - 例：田中
   - ※ 誰から受け取ったかを入力
3. **メモを入力（任意）**
   - 例：商品名など
4. **「記録する」ボタンをクリック**
   - 受け取り記録が保存される
   - 運営が確認後に、買い手のポイントカードに反映される

---

## 👨‍💼 運営用ページの機能

### 🔐 運営認証
- パスワードを入力してログイン
- 一般ユーザーはアクセスできない

### 🎫 QRコード生成（売り手用）
売り手が印刷して使うQRコードを作る機能

1. **売り手のユーザー名を入力**
   - 例：山田
2. **売り手のPayPay IDを入力**
   - 電話番号（例：09012345678）またはPayPay ID（例：mocky70025）
3. **「QRコードを生成」ボタンをクリック**
   - QRコードが表示される
4. **印刷またはダウンロード**
   - 売り手がこのQRコードを印刷して使う
   - 買い手がこのQRコードをスキャンして支払う

### 📊 売り手情報表示
売り手の名前を入力すると、その売り手の情報が表示される

- **累計入金金額**：その売り手が受け取った合計金額
- **取引回数**：何回取引があったか
- **取引履歴**：過去の取引の一覧
  - いつ、いくら、誰から受け取ったかが表示される

### ✅ 未処理の受け取り記録
売り手が記録した「受け取り記録」を確認して、ポイントカードに反映する機能

1. **未処理の受け取り記録が一覧表示される**
   - 売り手名、金額、買い手名、日時、メモが表示される
2. **「反映」ボタンをクリック**
   - 買い手情報が含まれている場合は、自動的に買い手のポイントカードに反映される
   - 買い手情報がない場合は、ドロップダウンから買い手を選択してから「反映」をクリック
3. **反映後**
   - 買い手のポイントカードに金額が追加される
   - 受け取り記録が「処理済み」になる

### 📋 全データ一覧
すべての記録を見る機能

#### 受け取り記録（全件）タブ
- すべての受け取り記録が表示される
- 処理済み・未処理の両方が表示される
- 売り手名、買い手名、金額、日時、メモ、ステータスが表示される

#### 支払い記録（全件）タブ
- すべての支払い記録が表示される
- 買い手名、売り手名、金額、日時が表示される

---

## 🔄 データの流れ（全体の仕組み）

### パターン1：通常の支払い（買い手が自分で支払いを記録）

```
1. 買い手がログイン
   ↓
2. 支払い金額を入力して「PayPayで支払う」をクリック
   ↓
3. PayPayアプリで実際に送金
   ↓
4. 「支払い完了」をクリック
   ↓
5. 買い手のポイントカードに金額が追加される
   ↓
6. 支払い記録が保存される
```

### パターン2：QRコードスキャンで支払い

```
1. 運営が売り手のQRコードを生成・印刷
   ↓
2. 買い手がQRコードをスキャン
   ↓
3. 支払いページが開く（売り手情報が表示される）
   ↓
4. 金額を入力してPayPayで送金
   ↓
5. 「支払い完了」をクリック
   ↓
6. 買い手のポイントカードに金額が追加される
   ↓
7. 支払い記録が保存される（売り手情報も記録される）
```

### パターン3：売り手が受け取りを記録（夜に運営が確認）

```
1. 売り手がログイン
   ↓
2. 「受け取り記録」で金額・買い手名・メモを入力
   ↓
3. 「記録する」をクリック
   ↓
4. 受け取り記録が「未処理」として保存される
   ↓
5. 運営が運営ページで未処理記録を確認
   ↓
6. 運営が「反映」ボタンをクリック
   ↓
7. 買い手のポイントカードに金額が追加される
   ↓
8. 受け取り記録が「処理済み」になる
```

---

## 💡 重要なポイント

### ✅ 自動化されていること
- 買い手が自分で支払いを記録すると、**自動的にポイントカードに反映される**
- 売り手が受け取り記録に買い手名を入力すると、運営が「反映」をクリックするだけで**自動的にポイントカードに反映される**

### ⚠️ 手動でやること
- 売り手が受け取り記録を登録する（買い手名も入力）
- 運営が未処理の受け取り記録を確認して「反映」ボタンをクリック

### 📱 PayPayについて
- **PayPay APIは使っていない**（個人利用のため認証が取れない）
- **PayPay個人送金**を使っている
  - QRコードやリンクでPayPayアプリを開く
  - 実際の送金はPayPayアプリで手動で行う
  - 送金完了後、システムで「支払い完了」をクリックして記録

### 🔒 セキュリティ
- パスワードは暗号化（bcrypt）されて保存される
- 運営ページはパスワードで保護されている
- 他人のアカウントに入っても、個人情報は保存されていない（ポイント情報のみ）

---

## 📊 データベースに保存される情報

### users（ユーザー）
- ユーザーID、ユーザー名、パスワード（暗号化）、PayPay ID

### payments（支払い記録）
- 支払いID、買い手ID、売り手ID、金額、日時

### seller_receipts（受け取り記録）
- 記録ID、売り手ID、買い手ID、金額、メモ、ステータス（未処理/処理済み）、日時

---

## 🎯 使い方の例

### 例1：田中さんが山田さんから1000円の商品を買う

**方法A：買い手が自分で記録**
1. 田中さんがログイン
2. 支払い金額「1000円」を入力
3. PayPayで山田さんに送金
4. 「支払い完了」をクリック
5. ✅ 田中さんのポイントカードに1000円が追加される

**方法B：QRコードで支払い**
1. 運営が山田さんのQRコードを生成・印刷
2. 田中さんがQRコードをスキャン
3. 支払いページが開く（山田さんの情報が表示される）
4. 金額「1000円」を入力してPayPayで送金
5. 「支払い完了」をクリック
6. ✅ 田中さんのポイントカードに1000円が追加される

**方法C：売り手が受け取りを記録**
1. 山田さんがログイン
2. 受け取り記録で「1000円」「買い手：田中」を入力
3. 「記録する」をクリック
4. 運営が運営ページで確認
5. 運営が「反映」ボタンをクリック
6. ✅ 田中さんのポイントカードに1000円が追加される

---

## 🚀 まとめ

このシステムは、**学校内での転売の支払いを簡単に管理するためのツール**です。

- **買い手**：支払いを記録してポイントカードに反映
- **売り手**：受け取りを記録（運営が確認後にポイントカードに反映）
- **運営**：QRコード生成、売り手情報確認、受け取り記録の処理、全データの確認

すべての支払いが記録され、ポイントカードで累計支払い金額を確認できます！

