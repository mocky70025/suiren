# LINE統合 ステップ5: 動作確認とテスト

## 🎯 このステップの目標

LINE公式アカウントが正しく動作するか確認し、ポイントカード表示機能をテストします。

## 📋 手順

### 1. LINE公式アカウントを友だち追加

1. ステップ1で取得したQRコードを表示
2. LINEアプリでQRコードをスキャン
3. 友だち追加を完了

### 2. 基本的なメッセージ送信をテスト

1. LINE公式アカウントに何かメッセージを送信（例：「こんにちは」）
2. 自動応答メッセージが返ってくるか確認
   - 現在の実装では、「ポイント確認」と送信するとポイントカードが表示されます

### 3. ポイントカード表示機能をテスト

#### 3-1. ユーザーを登録（まだの場合）

1. ウェブアプリにアクセス
2. 新規登録でユーザーを作成
3. ログイン

#### 3-2. LINEユーザーIDを紐づけ（手動）

現在は手動で紐づける必要があります。将来的にLINEログイン機能を追加します。

**方法1: データベースを直接編集（開発用）**

1. サーバーのデータベースにアクセス
2. `users`テーブルで、あなたのユーザーIDを確認
3. LINE Developersで、あなたのLINEユーザーIDを確認
   - 「Messaging API」→「Webhook設定」→「Webhookイベントの受信」でテスト送信
   - サーバーログでユーザーIDを確認
4. データベースで以下を実行：

```sql
UPDATE users SET line_user_id = 'あなたのLINEユーザーID' WHERE id = あなたのユーザーID;
```

**方法2: APIエンドポイントを使用（推奨）**

将来的に実装予定のLINEログイン機能を使用します。

#### 3-3. ポイントカードを表示

1. LINE公式アカウントに「ポイント確認」と送信
2. Flex Messageでポイントカードが表示されるか確認
   - 累計支払い金額が表示される
   - 支払い回数が表示される
   - 「支払いページを開く」ボタンが表示される

### 4. 支払いリンク送信機能をテスト（運営用）

運営画面から支払いリンクを送信する機能は、まだ実装されていません。
将来的に実装予定です。

## ✅ 完了チェックリスト

- [ ] LINE公式アカウントを友だち追加した
- [ ] メッセージを送信して応答を確認した
- [ ] ユーザーを登録した
- [ ] LINEユーザーIDをシステムユーザーと紐づけた
- [ ] 「ポイント確認」でポイントカードが表示された

## 📊 期待される動作

### 正常な場合

1. 「ポイント確認」と送信
2. Flex Messageでポイントカードが表示される
3. 「支払いページを開く」ボタンをクリック
4. ウェブアプリの支払いページが開く

### エラーの場合

- 「LINEユーザーIDが登録されていません」というメッセージが返ってくる
  → LINEユーザーIDを紐づける必要があります

## ⚠️ トラブルシューティング

### ポイントカードが表示されない

1. LINEユーザーIDが正しく紐づいているか確認
2. サーバーのログを確認
3. 環境変数が正しく設定されているか確認

### メッセージが返ってこない

1. Webhook URLが正しく設定されているか確認
2. サーバーが起動しているか確認
3. サーバーのログを確認

## ➡️ 次のステップ

ステップ5が完了したら、**ステップ6: フロントエンド統合**に進みます。
（LINEログイン機能、運営画面からのメッセージ送信機能など）

