# Webhook検証後の手順

## 🎯 「検証」ボタンをクリックした後

「検証」ボタンをクリックしたら、以下の手順を進めてください。

## 📋 手順（詳しく）

### ステップ1: 検証結果を確認

「検証」ボタンをクリックすると、以下のいずれかの結果が表示されます：

#### ✅ 成功した場合

- 「Webhookイベントの受信」が自動的に「利用する」に変わります
- 成功メッセージが表示されます（例：「Webhook URLの検証に成功しました」）
- 緑色のチェックマークや「成功」という表示が出ます

#### ❌ 失敗した場合

- エラーメッセージが表示されます
- 「Webhookイベントの受信」が「利用しない」のままです
- 赤色のエラー表示が出ます

### ステップ2: 検証が成功した場合の設定

検証が成功したら、以下の設定を行います：

#### 2-1. 「Webhookの利用」を確認

1. 「Webhookの利用」というセクションを探す
   - 「Webhook URL」の近くにあります
   - または、ページの下の方にあります

2. トグルスイッチを確認
   - 検証が成功すると、自動的に「利用する」になっている場合があります
   - もし「利用しない」になっていたら、**「利用する」に変更**してください

#### 2-2. 「応答メッセージ」を「利用しない」に設定

1. 「応答メッセージ」というセクションを探す
   - 「Webhookの利用」の近くにあります

2. トグルスイッチを**「利用しない」に設定**
   - ⚠️ **重要**：これにより、あなたのサーバーがメッセージを処理できます
   - 「利用する」のままにすると、LINEの自動応答が優先されてしまいます

### ステップ3: 設定を保存

1. 設定を変更したら、ページの上部または下部にある「保存」または「更新」ボタンをクリック
2. 保存が完了するまで待つ

## 📸 画面のイメージ

```
LINE Developers - Messaging API設定ページ

┌─────────────────────────────────────┐
│ Webhook URL                          │
│ https://suiren.onrender.com/...      │
│ [更新] [検証] ← ここをクリック       │
│                                      │
│ ✅ 検証成功                          │
└─────────────────────────────────────┘

┌─────────────────────────────────────┐
│ Webhookの利用                        │
│ ○ 利用する  ← これを選択            │
│ ● 利用しない                         │
└─────────────────────────────────────┘

┌─────────────────────────────────────┐
│ 応答メッセージ                        │
│ ● 利用する                           │
│ ○ 利用しない  ← これを選択           │
└─────────────────────────────────────┘
```

## ✅ 完了チェックリスト

検証後の設定が完了したら、以下を確認してください：

- [ ] 「検証」ボタンをクリックした
- [ ] 検証が成功した（成功メッセージが表示された）
- [ ] 「Webhookの利用」が「利用する」になっている
- [ ] 「応答メッセージ」が「利用しない」になっている
- [ ] 設定を保存した

## ⚠️ 検証が失敗した場合

### エラーメッセージの確認

検証が失敗した場合、エラーメッセージが表示されます。よくあるエラー：

#### エラー1: 「Webhook URLに接続できませんでした」

**原因**：
- サーバーが起動していない
- URLが間違っている
- サーバーがエラーで停止している

**対処法**：
1. Render Dashboardでサーバーが起動しているか確認
2. 「Logs」タブでエラーがないか確認
3. URLが正しいか再確認

#### エラー2: 「チャネルシークレットが一致しません」

**原因**：
- 環境変数の `LINE_CHANNEL_SECRET` が間違っている

**対処法**：
1. Render Dashboardで環境変数を確認
2. `LINE_CHANNEL_SECRET` が `1017478a22eb4c810faaeebebf10e0ee` になっているか確認

#### エラー3: 「HTTPSが必要です」

**原因**：
- URLが `http://` で始まっている

**対処法**：
- URLを `https://` に変更

## 🔍 動作確認

設定が完了したら、動作確認をします：

### 1. LINE公式アカウントを友だち追加

1. LINE Developers Consoleで「チャネル基本設定」を開く
2. 「QRコード」セクションでQRコードを表示
3. LINEアプリでQRコードをスキャン
4. 友だち追加を完了

### 2. メッセージを送信してテスト

1. LINE公式アカウントに何かメッセージを送信（例：「テスト」）
2. Render Dashboardの「Logs」タブを確認
   - Webhookイベントが受信されていれば成功
   - エラーが出ていないか確認

## 💡 次のステップ

Webhook URLの設定が完了したら、**動作確認とテスト**に進みます。

