# LINE公式アカウント統合計画

## 🎯 実装する機能

### 1. **LINEログイン（OAuth）**
- ユーザーがLINEアカウントでログインできるようにする
- LINEのユーザーIDを取得して、システムのユーザーと紐づける
- 既存のユーザー名/パスワードログインも残す

### 2. **LINEメッセージ送信機能**
- 支払いリンクをLINEで送信
- ポイントカード情報をLINEで表示
- 受け取り記録の通知をLINEで送信
- 運営からの通知をLINEで送信

### 3. **LINE公式アカウントでのポイントカード表示**
- Flex Messageでポイントカードを表示
- 累計支払い金額、支払い履歴を表示
- 支払いボタンから直接支払いページに遷移

### 4. **Webhook受信**
- LINEからのメッセージを受信
- コマンド処理（例：「ポイント確認」「支払い」など）

## 📋 実装手順

### ステップ1: LINE Developers設定
1. LINE Developersでアプリを作成
2. Messaging APIを有効化
3. Webhook URLを設定
4. チャネルアクセストークンを取得
5. LINEログイン（OAuth）を設定

### ステップ2: サーバー側の実装
1. `@line/bot-sdk`パッケージをインストール
2. LINE Messaging APIクライアントを作成
3. Webhookエンドポイントを実装
4. メッセージ送信機能を実装
5. LINEログイン（OAuth）エンドポイントを実装

### ステップ3: データベース拡張
1. `users`テーブルに`line_user_id`カラムを追加
2. LINEユーザーIDとシステムユーザーIDを紐づけ

### ステップ4: フロントエンド統合
1. LINEログインボタンを追加
2. LINE公式アカウントへのリンクを追加
3. 支払いリンク送信機能を追加

## 🔧 必要な技術

- **LINE Messaging API**: メッセージ送信
- **LINE Login**: ユーザー認証
- **Flex Message**: リッチなUI表示
- **Webhook**: LINEからのイベント受信

## 💡 実装イメージ

### ユーザーフロー例

1. **LINEログイン**
   ```
   ユーザーがLINEログインボタンをクリック
   → LINE認証画面に遷移
   → 認証完了後、システムに戻る
   → LINEユーザーIDを保存
   ```

2. **支払いリンク送信**
   ```
   運営が支払いリンクを送信
   → LINE公式アカウントからメッセージ送信
   → ユーザーがメッセージを開く
   → リンクをクリックして支払いページに遷移
   ```

3. **ポイントカード表示**
   ```
   ユーザーがLINE公式アカウントで「ポイント確認」と送信
   → Webhookで受信
   → データベースからポイント情報を取得
   → Flex Messageでポイントカードを表示
   ```

## 📝 次のステップ

1. LINE Developersでアプリを作成
2. チャネルアクセストークンを取得
3. サーバー側の実装を開始

