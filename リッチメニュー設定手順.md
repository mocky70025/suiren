# リッチメニュー設定手順

## 🎯 このステップの目標

LINE公式アカウントの下部メニューに「スタンプカード」と「支払い」ボタンを追加します。

## 📋 リッチメニューとは

リッチメニューは、LINE公式アカウントのトーク画面下部に表示されるメニューです。
- ユーザーがいつでもアクセスできる
- ボタンをクリックしてアクションを実行できる

## 📋 実装内容

### ボタン構成

1. **左側：スタンプカード**
   - クリックすると、ポイントカードが表示される
   - Postbackアクションを使用

2. **右側：支払い**
   - クリックすると、支払いページが開く
   - URIアクションを使用

## 🔧 リッチメニューの作成方法

### 方法1: APIで自動作成（推奨）

サーバーにエンドポイントを追加しました。以下のコマンドでリッチメニューを作成できます：

```bash
curl -X POST https://あなたのサーバーURL/api/line/richmenu/create \
  -H "Authorization: Bearer あなたのチャネルアクセストークン"
```

### 方法2: 運営画面から作成（今後実装予定）

運営画面にリッチメニュー作成機能を追加する予定です。

## 📋 手順

### ステップ1: リッチメニューを作成

1. ターミナルで以下を実行：

```bash
curl -X POST https://suiren.onrender.com/api/line/richmenu/create \
  -H "Content-Type: application/json"
```

2. レスポンスから `richMenuId` を取得

### ステップ2: リッチメニューをデフォルトに設定

1. 取得した `richMenuId` を使用：

```bash
curl -X POST https://suiren.onrender.com/api/line/richmenu/set-default/{richMenuId} \
  -H "Content-Type: application/json"
```

### ステップ3: 動作確認

1. LINE公式アカウントを開く
2. 下部にメニューが表示されることを確認
3. 「スタンプカード」ボタンをクリック → ポイントカードが表示される
4. 「支払い」ボタンをクリック → 支払いページが開く

## 🎨 リッチメニューの画像（オプション）

リッチメニューには画像を設定できますが、画像なしでも動作します。

画像を設定する場合：
1. 2500x1686ピクセルのPNG画像を用意
2. 左側に「スタンプカード」、右側に「支払い」のテキストやアイコンを配置
3. APIでアップロード

## ✅ 完了チェックリスト

- [ ] リッチメニューを作成した
- [ ] リッチメニューをデフォルトに設定した
- [ ] LINE公式アカウントでメニューが表示されることを確認した
- [ ] 「スタンプカード」ボタンが動作することを確認した
- [ ] 「支払い」ボタンが動作することを確認した

## 💡 動作の流れ

### スタンプカードボタンをクリック

1. ユーザーが「スタンプカード」ボタンをクリック
2. PostbackイベントがWebhookに送信される
3. サーバーがポイントカードを取得
4. Flex Messageでポイントカードを表示

### 支払いボタンをクリック

1. ユーザーが「支払い」ボタンをクリック
2. ウェブアプリの支払いページが開く
3. LINEユーザーIDで自動ログイン（実装済み）

## ⚠️ 注意事項

- リッチメニューは1つのチャネルに1つまで設定できます
- 既存のリッチメニューがある場合は、削除してから新規作成してください
- リッチメニューの変更は、LINEアプリを再起動しないと反映されない場合があります

